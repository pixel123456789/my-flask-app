<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liam | Web Developer Portfolio</title>
    <link rel="stylesheet" href="static/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <div class="logo">LK</div>
            <div id="dateTime" class="nav-date-time"></div>
            <button id="hamburger-menu" class="hamburger-menu">&#9776;</button>
            <ul id="desktop-menu">
                <li><a href="{{ url_for('home') }}">Home</a></li>
                {% if current_user.is_authenticated %}
                    <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                    <li><a href="{{ url_for('home') }}#contact">Contact</a></li>
                    <li><a href="{{ url_for('logout') }}">Logout</a></li>
                {% else %}
                    <li><a href="{{ url_for('home') }}#contact">Contact</a></li>
                    <li><a href="{{ url_for('register') }}">Register</a></li>
                    <li><a href="{{ url_for('login') }}">Login</a></li>
                {% endif %}
            </ul>
            <div id="mobile-menu" class="mobile-menu">
                <button id="close-btn" class="close-btn">&times;</button>
                <ul>
                    <li><a href="{{ url_for('home') }}">Home</a></li>
                    <br>
                    {% if current_user.is_authenticated %}
                        <li><a href="{{ url_for('dashboard') }}">Dashboard</a></li>
                        <br>
                        <li><a href="{{ url_for('home') }}#contact">Contact</a></li>
                        <br>
                        <li><a href="{{ url_for('logout') }}">Logout</a></li>
                        <br>
                    {% else %}
                        <li><a href="{{ url_for('home') }}#contact">Contact</a></li>
                        <br>
                        <li><a href="{{ url_for('register') }}">Register</a></li>
                        <br>
                        <li><a href="{{ url_for('login') }}">Login</a></li>
                    {% endif %}
                </ul>
            </div>
        </nav>
    </header>

    <!-- Flash message section -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash-message {{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <section id="home" class="hero">
        <div class="hero-content">
            <h1>Hello, I'm Liam!</h1>
            <div class="line"></div>
            <p>Turning ideas into interactive experiences with a touch of creativity and a lot of passion.</p>
            <a href="{{ url_for('site_map') }}" ><button class="btn-orange">Click To Learn About This Site</button></a>
        </div>
    </section>

    <section id="about">
        <div class="about-content">
            <h2>About Me</h2>
            <p>Hello! I am a dedicated student currently studying for a Scottish Higher in Computing Science. My journey into web development and software engineering is driven by a passion for technology and a desire to enhance my skills in these dynamic fields.</p>
        <p>As I continue my studies, I am eager to deepen my understanding of web development, programming, and software design. My goal is to pursue a fulfilling career in the tech industry, where I can contribute to innovative projects and make a meaningful impact.</p>
        <p>I am excited about the possibilities that lie ahead and am committed to continually learning and growing as a developer.</p>
        </div>
    </section>

    <section id="portfolio">
        <h2 id="port-h2">My Work</h2>
        <div class="portfolio-gallery">
            <!-- Portfolio items go here -->
            <div class="portfolio-item">
                <img src="portfolio1.jpg" alt="Project 1">
                <div class="overlay">
                    <div class="text">Project 1 - A cool web app I built.</div>
                </div>
            </div>
            <div class="portfolio-item">
                <img src="portfolio2.jpg" alt="Project 2">
                <div class="overlay">
                    <div class="text">Project 2 - Another exciting project.</div>
                </div>
            </div>
            <div class="portfolio-item">
                <img src="portfolio3.jpg" alt="Project 3">
                <div class="overlay">
                    <div class="text">Project 3 - My latest creation.</div>
                </div>
            </div>
        </div>
        <hr>
    </section>

    <section id="reviews">
        <h2>Reviews</h2>
        <div class="review-form-container">
            <form id="review-form">
                <input type="text" id="username" name="username" placeholder="Your Name" required>
                <input type="text" id="order-id" name="order-id" placeholder="Your Order ID" required>
                <textarea id="content" name="content" placeholder="Your Review" required></textarea>
                <div class="star-rating" id="star-rating">
                    <span class="star inactive" data-value="1">★</span>
                    <span class="star inactive" data-value="2">★</span>
                    <span class="star inactive" data-value="3">★</span>
                    <span class="star inactive" data-value="4">★</span>
                    <span class="star inactive" data-value="5">★</span>
                </div>
                <div class="rating-display" id="rating-display">Rating: 0</div>
                <button type="submit">Submit</button>
                <div id="form-errors" class="error-messages"></div>
            </form>
        </div>
        <div id="reviews-container">
            <div class="review-carousel" id="review-carousel">
                <!-- Reviews will be appended here -->
            </div>
        </div>
    </section>

    <section id="contact">
        <h2>Get in Touch</h2>
        <div class="contact-form">
            <form action="{{ url_for('contact') }}" method="post">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name" required>
                
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" required>
                
                <label for="message">Message:</label>
                <textarea id="message" name="message" rows="4" required></textarea>
                
                <button type="submit">Send Message</button>
            </form>
        </div>
    </section>

    
    <!-- Section Separator -->

    <footer>
        <p>&copy; 2024 Liam Kinnaird. All rights reserved.</p>
    </footer>

    <!-- GSAP and ScrollTrigger CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
    <script src="static/scripts.js"></script>
    <script>
        // Function to update date and time
        function updateDateTime() {
            const now = new Date();
            const dateTimeString = now.toLocaleString('en-US', {
                dateStyle: 'medium',
                timeStyle: 'medium',
                hour12: true
            });
            document.getElementById('dateTime').innerText = dateTimeString;
        }

        // Update the date and time every second
        setInterval(updateDateTime, 1000);
        // Initial call to display the date and time immediately
        updateDateTime();

       // Handle star rating selection
const starRatingContainer = document.getElementById('star-rating');
const ratingDisplay = document.getElementById('rating-display');
const errorMessages = document.getElementById('form-errors');
let selectedRating = 0;

starRatingContainer.addEventListener('click', function(event) {
    if (event.target.classList.contains('star')) {
        selectedRating = parseInt(event.target.dataset.value);
        updateStarRating();
        ratingDisplay.textContent = `Rating: ${selectedRating}`;
    }
});

function updateStarRating() {
    const stars = starRatingContainer.querySelectorAll('.star');
    stars.forEach(star => {
        if (parseInt(star.dataset.value) <= selectedRating) {
            star.classList.add('active');
            star.classList.remove('inactive');
        } else {
            star.classList.add('inactive');
            star.classList.remove('active');
        }
    });
}

// Handle review form submission
document.getElementById('review-form').addEventListener('submit', function(event) {
    event.preventDefault();
    
    const username = document.getElementById('username').value.trim();
    const content = document.getElementById('content').value.trim();
    const orderId = document.getElementById('order-id').value.trim();

    // Clear previous error messages
    errorMessages.textContent = '';
    
    if (selectedRating === 0) {
        showError('Please select a rating.');
        return;
    }

    fetch('/validate_order', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ orderId: orderId })
    }).then(response => response.json())
      .then(data => {
        if (data.valid) {
            fetch('/add_review', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    username: username,
                    content: content,
                    rating: selectedRating
                })
            }).then(response => response.json())
              .then(data => {
                if (data.success) {
                    addReviewToCarousel(username, content, selectedRating);
                    document.getElementById('review-form').reset();
                    selectedRating = 0;
                    updateStarRating();
                } else {
                    showError('Failed to submit review. Please try again.');
                }
            }).catch(error => {
                console.error('Error:', error);
                showError('An unexpected error occurred. Please try again later.');
            });
        } else {
            showError('Invalid Order ID. Please check and try again.');
        }
    }).catch(error => {
        console.error('Error:', error);
        showError('An unexpected error occurred. Please try again later.');
    });
});

function showError(message) {
    errorMessages.textContent = message;
}

// Function to add a review to the carousel
function addReviewToCarousel(username, content, rating) {
    const reviewsContainer = document.getElementById('review-carousel');
    const reviewItem = document.createElement('div');
    reviewItem.className = 'review-item';
    reviewItem.innerHTML = `
        <div class="stars">${'⭐'.repeat(rating)}</div>
        <div class="review-content">
            <strong>${username}</strong>: <p>${content}</p>
        </div>
    `;
    reviewsContainer.appendChild(reviewItem);
}

// Function to initialize the carousel
function initializeCarousel() {
    const reviewItems = document.querySelectorAll('#review-carousel .review-item');
    let currentIndex = 0;
    const intervalTime = 3000; // Adjust this time as needed

    function updateCarousel() {
        reviewItems.forEach((item, index) => {
            item.style.transform = `translateX(-${currentIndex * 100}%)`;
        });
    }

    function autoScroll() {
        currentIndex = (currentIndex + 1) % reviewItems.length;
        updateCarousel();
    }

    updateCarousel(); // Initialize carousel position
    setInterval(autoScroll, intervalTime); // Automatically scroll every `intervalTime` milliseconds
}

// Fetch and display existing reviews
function loadReviews() {
    fetch('/get_reviews')
        .then(response => response.json())
        .then(reviews => {
            reviews.forEach(review => {
                addReviewToCarousel(review.username, review.content, review.rating);
            });
            initializeCarousel();
        }).catch(error => {
            console.error('Error:', error);
            showError('Failed to load reviews. Please try again later.');
        });
}

document.addEventListener('DOMContentLoaded', function() {
        const button = document.querySelector('.hero-button');
        if (button) {
            button.classList.remove('hidden');
            button.classList.add('show');
        }
    });

// Mobile menu functionality
document.getElementById('hamburger-menu').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.toggle('active');
        });

        document.getElementById('close-btn').addEventListener('click', function() {
            document.getElementById('mobile-menu').classList.remove('active');
        });

// Load reviews on page load
window.addEventListener('load', loadReviews);

    </script>
</body>
</html>
